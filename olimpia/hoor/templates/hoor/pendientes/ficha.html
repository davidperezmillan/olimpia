{% extends "base_hoor_generic.html" %} {% load staticfiles %} {% block container %} {% if error_message %}
<p><strong>{{ error_message }}</strong></p>{% endif %}



<script type="text/javascript">
$(document).ready(function() {
    // Al hacer click sobre cualquier elemento que tenga el atributo data-user.....
    $('[data-url]').click(function(e) {
        e.preventDefault()
        var elem = $(this);
        $.ajax({
                url:   elem.attr('data-url'),
                type:  'get',
                beforeSend: function () {
                        elem.html("Procesando, espere por favor...");
                },
                success:  function (response) {
                        console.log("Success");
                        var visto = response.visto;
                        var descargado = response.descargado;
                        if (descargado===true){
                            if (visto===true){
                                 elem.attr('class','button icon fa-eye fit small truncate_text_oneline');
                                 elem.html('Visto');
                            }else{
                                elem.attr('class','button special icon fa-eye-slash fit small truncate_text_oneline');
                                elem.html('No Visto');
                            }
                        }else{
                            elem.attr('class','button alt icon fa-arrow-circle-down fit small truncate_text_oneline ');
                            elem.html('No Descargado');
                        }
                        console.log("Change success");
                        
                        
                },
                error: function(error){
                    alert("Error")
                    alert(error)
                }
        });
        
    });
       
    
});

</script>


<style type="text/css">
    details > summary:first-of-type {
        list-style-type: none;
    }
</style>

<section class="box">
    <div class="box alt">
        
        
       
        
        
            <form method="POST" class="post-form">
                {% csrf_token %}
                <div class="row">
                    <div class="6u 6u">
                        <label>{{ form.nombre.label_tag }} </label> {{ form.nombre }}
                    </div>
                    <div class="4u 4u">
                        <label>{{ form.estado.label_tag }} </label> {{ form.estado }}
                    </div>
                </div> <div class="row">
                    <div class="2u 2u">
                        
                            <label>Acciones</label>
                            <button type="submit" class="button special small">Save</button>
                        
                    </div>
                </div>
            </form>
            <!--<div class="row">-->
            <!--    <div class="8u 8u">-->
            <!--        <label>Ficha: {{ ficha.nombre }}</label>-->
            <!--    </div>-->
            <!--     <div class="4u 4u">-->
            <!--        <label>Estado:{{ficha.get_estado_display}}</label>-->
            <!--    </div>-->
            <!--</div>-->
            
            
            <div class="row">
                <div class="8u 8u">
                    
                        <label>Numero de temporadas existentes : {{slope_series_ficha|length}} </label>
                    
                </div>
                <div class="4u 4u">
                    
                        <a href="{% url 'index' %}" class="button special small">Volver</a>
                        {% if  ficha %}
                            <a href="{% url 'info_ficha' ficha.id %}" class="button alt small">Info Serie</a>
                        {% endif %}
                    
                </div>
            </div>
            
            <div class="row">
                <div class="4u 4u">
                    {% if down_series_ficha %}
                       <label>Calidad: {{down_series_ficha.quality}}</label>
                    {% endif %} 
                </div>
                 <div class="6u 6u">
                    {% if down_series_ficha %}
                        <label>Pendiente de descarga: {{down_series_ficha.ep_start}}</label>
                    {% endif %} 
                </div>
            </div> <div class="row">
                <div class="2u 2u">
                    
                        {% if down_series_ficha %}
                            <a href="{% url 'ver_down' down_series_ficha.id %}" class="button special small truncate_text_oneline">Editar descarga</a>
                        {% else %}
                            {% if  ficha %}
                                <a href="{% url 'add_down_for_ficha' ficha.id %}" class="button special small truncate_text_oneline">AÃ±adir descarga por ficha</a>
                            {% endif %}
                        {% endif %} 
                   
                </div>
            </div>

        <h2>Capitulos pendientes </h2>
        
         {% for temporada in slope_series_ficha reversed %}
            <details>
             <summary>
             <div class="row">
                <div class="6u 6u">
                    <h4> Temporada  {{ temporada.temporada.temporada }} </h4>
                </div>
                <div class="6u 6u">
                    
                    	<a href="{% url 'descargado_all_session' ficha.id temporada.temporada.temporada %}" class="button alt icon fa-check small">Marcar Descargado {{ temporada.temporada.temporada }} </a> 
                		<a href="{% url 'visto_all_session' ficha.id temporada.temporada.temporada %}" class="button alt icon fa-check small">Marcar Visto{{ temporada.temporada.temporada }} </a> 
                    
                </div>
            </div>
            </summary>
            
            <table style="overflow:auto;" id="book-table">
                <thead>
                    <tr>
                        <td>Capitulo</td>
                        <td>Nombre</td>
                        <!--<td>Descargado</td>-->
                        <!--<td>Visto</td>-->
                        <td>Estado</td>
                </thead>
                <tbody>
        
                    {% for capitulo in temporada.capitulos %} 
                        <tr>
                            <td>{{ capitulo.temporada }} x {{ capitulo.capitulo }}</td>
                            <td>{{ capitulo.nombre }}</td>
                            <!--<td>{{ capitulo.descargado }}</td>-->
                            <!--<td>{{ capitulo.visto }}</td>-->
                            <td>
                                
                                {% if capitulo.descargado %}
                                    {% if  capitulo.visto %}
                                        <a href="#" class="button  icon fa-eye fit small truncate_text_oneline" data-url="{% url 'toggle_capitulo' capitulo.id  %}">Visto</a>
                                    {% else %}
                                        <a href="#" class="button special icon fa-eye-slash fit small truncate_text_oneline" data-url="{% url 'toggle_capitulo' capitulo.id  %}">No Visto</a>
                                    {% endif %}
                                {% else %}
                                    <a href="#" class="button alt icon fa-arrow-circle-down fit small truncate_text_oneline" data-url="{% url 'toggle_capitulo' capitulo.id  %}">No Descargado</a>
                                {% endif %}
                            </td>
                            
                        </tr>
                    {% endfor %}
             
                </tbody>
                <!--<tfoot>-->
                <!--    <tr>-->
                <!--        <td colspan="2"></td>-->
                <!--        <td>100.00</td>-->
                <!--    </tr>-->
                <!--</tfoot>-->
            </table> 
        </details>
        {% endfor %}
        

    </div>
</section> 

{% endblock %}

 