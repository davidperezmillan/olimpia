{% extends "base_generic.html" %} 
{% block content %}

<title>
    {% if serie %}
        {{ serie.nombre }}
    {% else %}
        Nueva serie
    {% endif %}
</title>

{% if error_message %}
<p><strong>{{ error_message }}</strong></p>{% endif %}


<script type="text/javascript">
    $(document).ready(function() {
        $("#id_quality").on("change", function(event) {
            $('#id_ep_start').val(rellenarPattern($("#id_quality"), $('#id_ep_start'), "NRS00E00"));
            $('#id_ep_end').val(rellenarPattern($("#id_quality"), $('#id_ep_end'), "NRS99E99"));
            rellenarPattern($("#id_quality"), $('#id_ep_start'))
            rellenarPattern($("#id_quality"), $('#id_ep_end'))
        });
    });


    function rellenarPattern(quality, ep, defecto) {
        const regex = /(NR|HD|VO)(S[0-9]{2})(E[0-9]{2})/g;
        var str = ep.val();
        let m;
        return ((m = regex.exec(str)) !== null) ? quality.val() + m[2] + m[3] : defecto;
    }
</script>

<form method="POST" class="form-horizontal" action >

    <div class="form-group col-xs-5">
        {% csrf_token %} {{ form.as_p }} 
    
        
        {% if perms.mercurio.change_series %}
            <button type="submit" class="save btn btn-default">Grabar</button> 
        {% endif %} 
        {% if perms.mercurio.delete_series %}
            {% if serie %}
             <button type="button" class="delete btn btn-default" onclick="window.location='{% url 'control_delete' serie.id %}'">Borrar</button> 
            {% endif %}  
        {% endif %} 
        <button type="Cancel" class="cancel btn btn-default" onclick="window.location='{% url 'portada' %}'">Volver</button>
    </div>
{% endblock %}
